<!DOCTYPE html>
<html>

<head>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title></title>

	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
	</script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
	</script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
	</script>

	<script src="/webix/codebase/webix.js"></script>
	<script src="/js/funciones_webix.js"></script>
	<script src="/webix/codebase/locale.js"></script>
	<link rel="stylesheet" type="text/css" href="/webix/codebase/webix.css" />
	<link rel="stylesheet" href="https://cdn.materialdesignicons.com/2.7.94/css/materialdesignicons.css?v=6.3.5" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
	<script src="/js/momentjs.js"></script>
	<%
    /*
	LOCAL llError, lcCentro, lcPie, llAplicar, lnOficio, lcOficio, lcPrevio, lnMens_usua
	LOCAL llNBusca, lcCVE, lcIniciales, lnIden, lcRuta_tabl
	LOCAL lcDiri_nomb, lnDiri_codi, lcDiri_carg, lcAten_nomb, lnAten_codi, lcAten_carg, llNBusca2, lnCant_ofic

	  
	lnID = VAL(Request.QueryString("lnID"))



	lcCve = ALLTRIM(cSoli.cve)

	IF SQLEXEC(lnCone_cgce, "SELECT * FROM gen_op_grupo WHERE id_grupo = ?lnID", "cGrupo") != 1
		a=Aerror(Mat)
		?SQLDISCONNECT(0)
		Response.write(Mat(2) + " Linea: 67")
		return
	ENDIF

	IF SQLEXEC(lnCone_cgce, "SELECT * FROM opc_op_config", "op_config") != 1
		a=Aerror(Mat)
		SQLDISCONNECT(0)
		sdsd
	ENDIF

	lcSQL = "SELECT id_depe,cve, depen, corto FROM ser_depen c WHERE id_depe in (SELECT DISTINCT id_depe FROM ser_pers_serv WHERE user_id = ?pcUser) AND cve = 'CGRH' "

	IF SQLEXEC(lnCone_cgce, lcSQL, "cArea_rh") != 1
		a=Aerror(Mat)
		SQLDISCONNECT(0)
		Response.write(Mat(2))
		return 
	ENDIF

	SQLDISCONNECT(0)
    */
%>
</head>

<body onLoad="doOnLoad();">
	<div id="div_atencion" style="background-color: #F4F4F4;"></div>
	<script>
		const validaFecha = (text, format)=>{
			return moment(text, format,true).isValid();
		}
		function doOnLoad() {

			webix.ui.datafilter.rowCount = webix.extend({
				refresh: function (master, node, value) {
					node.firstChild.innerHTML = "Total: " + master.count();
				}
			}, webix.ui.datafilter.summColumn)


			var ui = webix.ui({
				view: "scrollview",
				id: "verses",
				scroll: "y",
				body: {
					margin: 30, rows: [
						{
							rows: [
								{
									view: "form", id: "form_busc", name: "form_busc",
									rows: [
										{
											cols: [
												{ view: "text", id: "txtNOficio", name: "txtNOficio", label:"Número de incio", labelPosition:"top", width: 200},
												{ view: "text", id: "txtNOficio2", name: "txtNOficio2", label:"Número de fin", labelPosition:"top", width: 200},
                                                { view: "combo", id: "cmbSoli", name: "cmbSoli",
                                                    //value: "<% // Response.Write(IIF(pnId_cent = 4, 'DG HCG', ALLTRIM(cSoli.cve)))%>",
                                                    label: "Oficio de",
                                                    value:"<%=rows[0].cve%>",
                                                    labelPosition:"top",
                                                    required: true, invalidMessage: "Este campo no puede ir vacio",
                                                    options: {
                                                        fitMaster: false,
                                                        width: 500,
                                                        body: {
                                                            data: [
                                                                <%for (var i = 0; i < rows.length; i++) {%>
                                                                { id: "<%= rows[i].cve%>", value: "(<%=rows[i].cve%>) <%=rows[i].depen%>" },
                                                                <%}%>
                                                            ]
                                                        }
                                                    },
                                                },
                                                {view: "select", label: "Año", id: "cmbAnio", name: "cmbAnio", value: <%=new Date().getFullYear()%>, width: 100,
                                                    labelPosition: "top", labelAlign: "left", options: [
                                                        <%
                                                        for (var i = new Date().getFullYear(); i >= 2021; i--){%>
                                                            { id: <%=i%>, value: "<%=i%>" },
                                                        <%
                                                        }
                                                        %>
                                                    ],
                                                },
											]
										},
                                        {
											cols: [
												{ view: "datepicker", id: "txtFec_ini", name: "txtFec_ini", label:"Fecha incio", labelPosition:"top", width: 200},
												{ view: "datepicker", id: "txtFec_fin", name: "txtFec_fin", label:"Fecha fin", labelPosition:"top", width: 200},
                                                { view: "text", id: "txtDepen", name: "txtDepen", label:"Dependencia", labelPosition:"top"},
											]
										},
                                        {
											cols: [
												{ view: "textarea", id: "txtConcepto", name: "txtConcepto", label:"Concepto", labelPosition:"top", height:100},
												{ view: "textarea", id: "txtRefe", name: "txtRefe", label:"Referencia", labelPosition:"top", height:100},
                                                { view: "textarea", id: "txtAnexo", name: "txtAnexo", label:"Anexo", labelPosition:"top", height:100},
                                                
											]
										},
										{
											cols: [
                                                { view: "text", id: "txtPersona", name: "txtPersona", label:"Persona", labelPosition:"top"},
                                                { maxWidth: 15 },
												{
													view: "select", label: "Tipo", id: "cmbTipo", value: 0, width: 120,
													labelPosition: "top", labelAlign: "left", options: [
													    { id: 0, value: "TODOS" },	
                                                        { id: 1, value: "Dirigido a" },
														{ id: 2, value: "Con copia" },
														/*
														{ id: 3, value: "Autoriza" },
														{ id: 4, value: "Vo. Bo." },
														*/
														{ id: 5, value: "Atenci&oacute;n a" },
														
													]
												},
                                                { maxWidth: 15 },
                                                {
													view: "select", label: "Tipo", id: "cmbStatus", value: -1, width: 200,
													labelPosition: "top", labelAlign: "left", options: [
                                                        { id:-1, value: "TODOS" },
														<%for (var i = 0; i < rows2.length; i++) {%>
                                                        { id:"<%=rows2[i].STATUS%>", value: "<%=rows2[i].DESCRIP%>" },
                                                        <%}%>
														
													]
												},
											]
										},
										{
											cols: [
												{
													view: "button", type: "icon", icon: "mdi mdi-magnify", label: "Buscar", width: 170,
													on: {
														onItemClick: function () { genera(); }
													}
												},
											]
										},
										{
                                            view:"datatable", id:"dtable", select:true, footer:true, editable:true, hidden:false, minHeight:500, scroll:true,
                                            resizeColumn: true,  navigation: true, resizeRow:true, css:"celda_compacta", 
                                            rightSplit:1, leftSplit:3,
                                            scheme: {
                                                $init: function (obj) {
                                                    obj.fecha = (obj.fecha ? (obj.fecha == '01/01/1900'?'': convertDate(obj.fecha) ) : '');
                                                }
                                            },

                                            columns:[
                                            {
                                                id: "detalle", width: 40,sort: "int", css: { 'text-align': 'center' }, 
                                                header: [{text:"",css:"my_style"}, {text:""}],
                                                template:(obj)=>{
                                                    return `
                                                        <a href="#" onClick="window.parent.deta_sali('${obj.cve}',${obj.idoficio},${obj.anio},${obj.id_iden},'op_reof0.fwx');">
                                                            <i style='font-size:26px;color:#2b96cc;' class='fa-solid fa-magnifying-glass'></i>
                                                        </a>`
                                                }
                                            },
                                            {
                                                id: "doc", width: 80,sort: "int", css: { 'text-align': 'left' }, hidden:false,
                                                header: [{text:"Doc.",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                                template:(obj)=>{
                                                    if(obj.doc != ''){
                                                    //	return `<a href="#" onClick="window.open('${obj.doc}');">
                                                    //		<img alt="Detalle del oficio" src="/imagenes/word.png" width="28" height="28" border="0">
                                                    //	</a>`
                                                    return `<div class='webix_el_button' style='cursor: pointer;' align='center'><a href='${obj.doc}' target='_blank'><i style='font-size:32px;color:#2b96cc;' class='far fa-file-word'></i></a></div>`
                                                    }else{
                                                        return `<input type="button" name="btnGenera" id="btnGenera" value="Generar" 
                                                            onclick="gene_gdoc('${obj.cve.trim()}','${obj.idoficio}','${obj.anio}','${obj.id}' );">`
                                                    }
                                                },
                                            },
                                            {
                                                id: "rank", width: 70,sort: "int", css: { 'text-align': 'center' }, 
                                                header: [{text:"#",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },	
                                            {
                                                id: "oficio", width: 150,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Oficio",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },	
                                            {
                                                id: "fecha", header: ["Fecha", { content: "textFilter", compare:dateStringFilter }], sort: "date", width: 100, format:webix.Date.dateToStr("%d/%m/%Y")
                                            },	
                                            {
                                                id: "hora", header: ["Hora", { content: "textFilter"}], width: 70,
                                            },	
                                            {
                                                id: "centros", width: 200,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Centros",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },		
                                            {
                                                id: "concepto", 
                                                $height:160, 
                                                fillspace:true, minWidth:300,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Concepto",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                    
                                                }],
                                            },		
                                            {
                                                id: "referencia", width: 70,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Ref.",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },		
                                            {
                                                id: "anexo", width: 70,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Anexo",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },	
                                            {
                                                id: "solicitado", width: 70,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Solic.",css:"my_style"}, {
                                                    content: "textFilter", placeholder:"Filtrar",
                                                }],
                                            },		
                                            {
                                                id: "stat_desc", width: 100,sort: "string", css: { 'text-align': 'left' }, 
                                                header: [{text:"Status",css:"my_style"}, {
                                                    content: "selectFilter", placeholder:"Filtrar",
                                                }],
                                            },
                                            ],
                                        }
									]
								}
							]
						}
					]
				}
			});
			webix.ui({
				view: "window", id: "mues_plan",
				move: true, left: 150, top: 0, width: 900, height: 550, resize: true,
				head: {
					view: "toolbar", id: "plantilla",
					cols: [
						{ view: "label", label: "Plantillas" },
						{ view: "icon", icon: 'mdi mdi-close', click: "$$('mues_plan').hide();" }
					]
				},
				body: {
					view: "iframe",
					src: "/op/op_plan"
				}
			});

			mues_soli();
			obtenerSeccion()
			var listServicio = $$("cmbServicio").getPopup().getList();
			listServicio.attachEvent("onAfterSelect", function (id) {
			  dirigido(id, 9)
			});


		}

		function genera() {
            let form = $$("form_busc").getValues()

            console.log(form)

            $$("dtable").clearAll()
            $$("dtable").load("/api/op/op_reof0x?loForm=" + JSON.stringify(form))
		}

	</script>
</body>


</html>