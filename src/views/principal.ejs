<%- include('partials/header'); %>

  <style>
  .details_placeholder {
    padding: 20px;
    color: #888;
    font-style: italic;
  }
  .details_container {
    display: flex;
    align-items: center;
    padding: 10px;
  }
  .details_container .avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-right: 20px;
  }
  .details_container .details_name {
    font-size: 18px;
    font-weight: bold;
    color: #333;
  }
  .details_container .details_info {
    font-size: 14px;
    color: #555;
    line-height: 1.6;
  }

</style>

<style>
  .container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 220px;
    height: 100px;
    margin: auto;
    padding: 10px;
    border: 1px solid #ccc;
    font-family: sans-serif;
  }

  .text-content {
    flex: 1;
    padding-right: 10px;
    /* Eliminamos el overflow: hidden y el white-space: nowrap de aqu� */
  }

  .text-content h1 {
    font-size: 0.9em; /* Reducimos el tama�o de la fuente para que quepa mejor */
    margin: 0 0 5px 0;
    line-height: 1.2;
    /* Quitamos:
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    Ahora el texto se ajustar� a una nueva l�nea si es necesario. */
  }

  .text-content p {
    font-size: 0.8em;
    margin: 0;
    line-height: 1.2;
    white-space: normal; /* Aseguramos que el texto de la carrera tambi�n pueda ajustarse */
    overflow: hidden;
  }

  .image-container {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>

<style> 
  .mark{
    width:100px;
    text-align: center;
    font-weight:bold;
    float:right;
    background-color:#444;
    color:white;
    border-radius:3px;
  }
  .newtime{
  	background-color:#628224;
  }
  .oldtime{
  	background-color:#e63946;
  }	
</style>

</head>

<body>
  <div id="app_container" style="width:100%; height:100vh;"></div>

  <script type="text/javascript">
    webix.ready(function(){

  var token = <%- JSON.stringify(token) %>;
  var visitas = <%- JSON.stringify(visitas) %>;
  var pagina = <%- JSON.stringify(pagina) %>;
  var pagina_t = <%- JSON.stringify(pagina_t) %>;

      webix.ui({
        // PASO 3: La propiedad 'container' apunta al id del div de arriba
        container: "app_container",

	cols: [
		{
			"width": 300,
			"rows": [
				{ "padding": { "left": 10 },
					"cols": [
						{ "view": "label", "label": "Eventos de seguridad últimos 14 días" },
					]
				},
				{
  view:"list",   
  scheme:{
    $init:function(obj){
      if (obj.evento=='LOG_IN') obj.$css = "newtime";
      if (obj.evento=='LOG_OUT') obj.$css = "oldtime";
    }
  },  
  template:"<div class='mark'>#total# </div> #evento#. (#dia#) #ip_address#",
  type:{
    height:62
  },
  select:true,     
  data:webix.copy(token)
},
			]
		},
		{
			"rows": [
  { 
      view: "template", 
      type: "header", 
      template: "Actividad de Páginas y Consultas Último 7 días",
  },
	{
  view:"chart",
  type:"bar",
  barWidth:60,
  radius:2,
  gradient:"rising",
  xAxis:{
    template:"'#dia#"
  },
  legend:{
    values:[{text:"Páginas",color:"#58dccd"},{text:"Consultas",color:"#a7ee70"},{text:"Total",color:"#36abee"}],
    valign:"middle",
    align:"right",
    width:90,
    layout:"y"
  },
  series:[
    {
      value:"#pagina#",
      color: "#58dccd",
      tooltip:{
        template:"Día: #dia# <br/>Páginas #pagina#"
      }
    },
    {
      value:"#consulta#",
      color:"#a7ee70",
      tooltip:{
        template:"Día: #dia# <br/>Consultas #consulta#"
      }
    },
    {
      value:"#total#",
      color:"#36abee",
      tooltip:{
        template:"Día: #dia# <br/>Total #total#"
      }
    }
  ],
  data:visitas
},
				{
					"cols": [
{
      view:"datatable",
      columns:[
        { id:"dia", header:"Día",  width:200, sort:"string", css:{"text-align":"center"},},
        { id:"apartado",	 header:"Apartado",  width:180, sort:"string"},
        { id:"total",	 header:"Consultas",  width:180, sort:"int", css:{"text-align":"right"},
          format: function(value){
            return webix.Number.format(value, {
                decimalSize: 0,
                groupSize: 3,
                decimalDelimiter: ".",
                groupDelimiter: ","
            });
          }
        },
        { id:"tiempo",  header: "Tiempo ms", width: 180, sort:"int", css:{"text-align":"right"},
          format: function(value){
            return webix.Number.format(value, {
                decimalSize: 0,
                groupSize: 3,
                decimalDelimiter: ".",
                groupDelimiter: ","
            });
          }
        },
      ],
      autowidth:true,
      math: true,
      data: pagina
   	},
    {
  view:"chart",
  type:"area",
  xAxis:{
    template:"'#apartado#"
  },
  yAxis:{
    start:0,
    step:10,
  },
  legend:{
    values:[{text:"Visitas",color:"#58dccd"},{text:"Tiempo décimas de segundo",color:"#914ad8"}],
    valign:"middle",
    align:"right",
    width:90,
    layout:"y"
  },
  eventRadius: 5,
  series:[
    {
      alpha:0.7,
      value:"#total#",
      color: "#58dccd",
      tooltip:{
        template:"Visitas<br/>veces: #total#"
      }
    },
    {
      alpha:0.5,
      value:"#tiempo#",
      color:"#914ad8",
      tooltip:{
        template:"Tiempo<br/>ds: #tiempo#"
      }
    },
  ],
  data:pagina_t

  
}
					]
				}
			]
		}
	]
      });
    },50);


    function genera2(folio){
// Se filtra el dataview
    $$("students_dataview").filter(function (item) {
    // Busca si el nombre o la descripci�n contienen el texto del filtro
    return (
        item.name.toLowerCase().indexOf(folio) !== -1 ||
        item.specialty.toLowerCase().indexOf(folio) !== -1
        );
    });
    //console.log(folio);
    }
  </script>
</body>
</html>