<%- include('partials/header'); %>

<style>
    .mi-boton-azul .webix_button {
        background-color: #0dc8ee !important;
        color: white !important;
        border-radius: 5px;
    }

    /* Opcional: Color al pasar el mouse (hover) */
    .mi-boton-azul .webix_button:hover {
        background-color: #16acce !important;
    }

</style>

<body>
    <script>
        var tip = 0;
        var w1;
        var mygrid;

		const loDere = [
			<%for (var i = 0; i < rows.length; i++) {%>
			{ 
				CVE: "<%=rowsd[i].cve%>",
				DEPEN: "(<%=rowsd[i].cve%>) <%=rows[i].depen%>",
				TITULAR: `<%=rowsd[i].titular%>`,
			},
			<%}%>
		]


        //alert(tip);

        //function doOnLoad() {
        webix.ready(function(){


            webix.ui.datafilter.rowCount = webix.extend({
                refresh: function (master, node, value) {
                    node.firstChild.innerHTML = "Total: " + master.count();
                }
            }, webix.ui.datafilter.summColumn)


            var ui = webix.ui({
                space: "wide",
                rows: [
                    {
                        view: "toolbar", padding: 3, borderless: true, elements: [
                            {
                                view: "combo", id: "cmbSoli", name: "cmbSoli", value: "<%=rows[0].id%>",
                                width: 600,
                                options: {
                                    fitMaster: false,
                                    width: 600,
                                    body: {
                                        data: [
                                    <% // 
                                    /*
                                            SELECT cSoli
                                    GO TOP
                                    SCAN
                                    */
                                            %>
                                    //        { id: <% //  Response.Write(cSoli.id_cent) %>, value: "<% // Response.Write(ALLTRIM(cSoli.depen))%>" },
                                    <% //  ENDSCAN %>
                                    <%for (var i = 0; i < rows.length; i++) {%>
                                    { id: "<%= rows[i].cve%>", value: "(<%= rows[i].cve%>) <%=rows[i].depen%>" },
                                    <%}%>

                                ]
                                    }
                                },
                                on: {
                                    //onChange: genera

                                }
                            },
                        ]
                    },
                    {
                        view: "datatable", id: "dtable", name: "dtable", select: "row", editaction: "dblclick", rowCss: "#css#", drag:true, 
                        columns: [
                            { id: "CVE", template:"{common.checkbox()}", header: ["Clave"], css: { 'text-align': 'center' }  },
                            { id: "DEPEN", header: ["Dependencia", { content: "selectFilter" }], width: 380, sort: "string", css: { 'text-align': 'left' } },
                            { id: "TITULAR", header: ["Titular", { content: "textFilter" }], width: 100, sort: "string", css: { 'text-align': 'left' } },
                        ],
                        footer: true, scrollY: true, scrollX: true, resizeColumn: true, resizeRow: true, navigation: true,
                        editable: true, 
                        data:loDere,
                        on: {
                            onBeforeLoad: function () { this.showOverlay("Cargando..."); },
                            onAfterLoad: function () {
                                this.hideOverlay();
                                //this.adjustRowHeight("nomb_serv", true);
                                this.render();
                            },
                            
                        },
                        onClick: {
                            // Esta función se dispara solo cuando haces clic en la clase CSS que definimos arriba
                            "buscar_detalles": function(ev, id) {
                                var item = this.getItem(id); // Obtenemos el registro completo
                                
                                // Aquí pones la lógica de lo que quieras que haga la lupa
                                webix.message("Buscando detalles de: " + item.MODI_GROU);
                                
                                // Ejemplo: Abrir una ventana o cargar datos en un formulario
                                //abrirVentanaDetalles(item.MODI_GROU);
                                showWindow(item.MODI_GROU, item.DESCRIP);
                                
                                return false; // Evita que se disparen otros eventos de la fila
                            }
                        }
                    },
                ]
            });

						webix.ui({
	            view:"contextmenu", id:"cmenu", master:$$("dtable"), width:220,
	            data:[
	              {value:"Eliminar grupo", id:"eliminaGrupo"},
	              
	            ],
	            on:{
	              "onItemClick":function(id){
	                var id_grup = $$("dtable").getSelectedId();
	                if(id === "eliminaGrupo"){
	                	console.log(id_grup)
	                  eliminaGrupo(id_grup.id)
	                }
	                
	              }
	            }
	          });

            //genera();
        });

        function genera() {
            $$("dtable").clearAll();
            $$("dtable").load("/api/progap/progap_estudiax?lnConv=" + $$("cmbSoli").getValue() )

        }

        function deta_grup(id) {
            window.parent.parent.$$("tbView").addView({
                header: "<span class='webix_icon mdi mdi-file-document-outline'></span>" + (id == undefined ? "Nuevo" : "Modifica") + " Estudiante",
                body: {
                    view: "iframe", src: "/progap/progap_nestudia?lnID=" + id,
                    type: {
                        height: 60
                    }
                },
                close: true
            });
            window.parent.parent.$$("tbView").getTabbar().setValue(window.parent.parent.$$("tbView").getTabbar().data.options[window.parent.parent.$$("tbView").getTabbar().data.options.length - 1].id);
        }

        function eliminaGrupo(id) {

          Swal.fire({
					  title: "", text: 'Seguro de eliminar el grupo?', icon: 'warning', showCancelButton: true,
					  confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Si', cancelButtonText:"No",
					}).then((result) => {
						if(result.isConfirmed){
							webix.ajax().post("/<% // Response.write(config.ruta)%>/op_ngrupx.fwx?t=1", {id:id}).then((res)=>{
								res = res.json();
								Swal.fire('', res.message, res.status?"success":"error").then(()=>{
									if(res.status){
										genera()
									}
								})
							})
						}
					})
        }



        function agregar() {

            var checked = [];
            $$("dtable").data.each(function (obj) {
                if (obj.marcar == 1) checked.push(obj.id);
            });
            
            $$("dtable").remove(checked);
            window.parent.parent.carg_grupo(checked.toString());
        }

    </script>
</body>


</html>