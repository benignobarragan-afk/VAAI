<%- include('../partials/header'); %>

<style>
    .mi-boton-azul .webix_button {
        background-color: #0d6efd !important;
        color: white !important;
        border-radius: 5px;
    }

    /* Opcional: Color al pasar el mouse (hover) */
    .mi-boton-azul .webix_button:hover {
        background-color: #428dfc !important;
    }

    .mi-boton-amarillo .webix_button {
        background-color: #fec007 !important;
        color: black !important;
        border-radius: 5px;
    }

    /* Forzamos el color directamente a la clase del icono */
    .mi-boton-amarillo .mdi {
        color: #000000 !important;
    }

    /* Opcionalmente, para asegurar que el círculo del icono también cambie */
    .mi-boton-amarillo .webix_icon_btn {
        color: #000000 !important;
    }

    /* Opcional: Color al pasar el mouse (hover) */
    .mi-boton-amarillo .webix_button:hover {
        background-color: #f4d36f !important;
    }

</style>
<body>
    <div align="center" id="cuerpo">
        <form name="form1" id="form1" method="post" action="/<% // Response.Write(config.ruta)%>/op_bgrup.fwx">
            <div id="view_ui"></div>
        </form>
    </div>
    <script>
        var tip = 0<% // Response.write(lnTipo)%>;
        var w1;
        var mygrid;

        //alert(tip);

        //function doOnLoad() {
        webix.ready(function(){
            webix.ui.datafilter.rowCount = webix.extend({
                refresh: function (master, node, value) {
                    node.firstChild.innerHTML = "Total: " + master.count();
                }
            }, webix.ui.datafilter.summColumn)


            var ui = webix.ui({
                space: "wide",
                rows: [
                    {
                        view: "toolbar", padding: 3, borderless: true, elements: [
                            {
                                view: "button",
                                type: "icon",
                                icon: "mdi mdi-sync",
                                align: "left",
                                label: "",
                                width: 40,
                                on: {
                                    onItemClick: genera
                                }
                            },
                            {
                                view: "button",
                                type: "icon",
                                icon: "mdi mdi-plus",
                                label: "Crear programa",
                                width: 180,
                                on: {
                                    onItemClick: function () { deta_grup() }
                                }
                            },
                            {
                                view: "button",
                                type: "icon",
                                icon: "mdi mdi-file-excel",
                                label: "Descargar",
                                width: 130,
                                on: {
                                    onItemClick: function () { 
                                        webix.toExcel("dtable", {
                                            //spans:true,
                                            //styles:true
                                        });
                                     }
                                }
                            },
                            {},
                            {
                                view: "button",
                                type: "icon",
                                icon: "mdi mdi-upload",
                                label: "Actualizar",
                                tooltip: "Subir lista de programas existentes (Se actualizaran los ya existentes e insertaran los nuevos)",
                                css: "mi-boton-azul", // Aplicamos la clase
                                width: 130,
                                on: {
                                    onItemClick: function () { 
                                        window.parent.parent.deta_impo(1);
                                     }
                                }
                            },
                            {
                                view: "button",
                                type: "icon",
                                icon: "mdi mdi-power",
                                label: "Activar/Desactivar",
                                tooltip: "Activar Programas de forma masiva (subir lista de los activos todos los demás se desactivaran)",
                                css: "mi-boton-amarillo", // Aplicamos la clase 
                                width: 180,
                                on: {
                                    onItemClick: function () { 
                                        window.parent.parent.deta_impo(2);
                                     },

                                }
                            },

                        ]
                    },
                    {
                        view:"datatable", id:"dtable", select:true, footer:true, editable:true, hidden:false, minHeight:500, scroll:true,
                        resizeColumn: true,  navigation: true, resizeRow:true, css:"celda_compacta", tooltip: true, 
                        rightSplit:1, leftSplit:3,
                        scheme: {
                            $init: function (obj) {
                                obj.fecha = (obj.fecha ? (obj.fecha == '01/01/1900'?'': convertDate(obj.fecha) ) : '');
                            }
                        },

                        columns:[
                        {
                            id: "detalle", width: 40,sort: "int", css: { 'text-align': 'center' }, 
                            header: [{text:"",css:"my_style"}, {text:""}],
                            template:(obj)=>{
                                return `
                                    <a href="#" onClick="deta_grup(${obj.id});">
                                        <i style='font-size:26px;color:#2b96cc;' class='fa-solid fa-magnifying-glass'></i>
                                    </a>`
                            }
                        },
                        {
                            id: "rank", width: 70,sort: "int", css: { 'text-align': 'center' }, 
                            header: [{text:"#",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },	
                        {
                            id: "clave_cgipv", width: 150,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Clave CGIPV",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },	
                        {
                            id: "siglas", width: 100,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"C.U.",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },
                        {
                            id: "nivel", width: 150,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Nivel",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },			
                        {
                            id: "programa", 
                            height:160, 
                            fillspace:true, minWidth:300,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Nombre",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                                
                            }],
                        },		
                        {
                            id: "clave_911", width: 100,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Clave 911",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },
                        {
                            id: "duracion", width: 100,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Duración",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },		
                        {
                            id: "participa", width: 100,sort: "string", css: { 'text-align': 'left' }, 
                            header: [{text:"Participa",css:"my_style"}, {
                                content: "excelFilter", placeholder:"Filtrar",
                            }],
                        },
                        ],
                    },
                ]
            });

/* 			webix.ui({
            view:"contextmenu", id:"cmenu", master:$$("dtable"), width:220,
            data:[
                {value:"Eliminar grupo", id:"eliminaGrupo"},
                
            ],
            on:{
                "onItemClick":function(id){
                var id_grup = $$("dtable").getSelectedId();
                if(id === "eliminaGrupo"){
                    console.log(id_grup)
                    eliminaGrupo(id_grup.id)
                }
                
                }
            }
            });
 */
            genera();
        });

        function genera() {
            $$("dtable").clearAll();
            $$("dtable").load("/api/progap/progap_prograx")

        }

        function deta_grup(id) {
            window.parent.parent.$$("tbView").addView({
                header: "<span class='webix_icon mdi mdi-file-document-outline'></span>" + (id == undefined ? "Nuevo" : "Modifica") + " Estudiante",
                body: {
                    view: "iframe", src: "/progap/progap_nprogra?lnID=" + id,
                    type: {
                        height: 60
                    }
                },
                close: true
            });
            window.parent.parent.$$("tbView").getTabbar().setValue(window.parent.parent.$$("tbView").getTabbar().data.options[window.parent.parent.$$("tbView").getTabbar().data.options.length - 1].id);
        }

        function eliminaGrupo(id) {

          Swal.fire({
					  title: "", text: 'Seguro de eliminar el grupo?', icon: 'warning', showCancelButton: true,
					  confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Si', cancelButtonText:"No",
					}).then((result) => {
						if(result.isConfirmed){
							webix.ajax().post("/<% // Response.write(config.ruta)%>/op_ngrupx.fwx?t=1", {id:id}).then((res)=>{
								res = res.json();
								Swal.fire('', res.message, res.status?"success":"error").then(()=>{
									if(res.status){
										genera()
									}
								})
							})
						}
					})
        }



        function agregar() {

            var checked = [];
            $$("dtable").data.each(function (obj) {
                if (obj.marcar == 1) checked.push(obj.id);
            });
            
            $$("dtable").remove(checked);
            window.parent.parent.carg_grupo(checked.toString());
        }

    </script>
</body>


</html>